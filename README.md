# SecureNotes

A secure notes extension for VS Code/Cursor with end-to-end encryption support.

## Features

- ğŸ“ **File Browser**: Tree view for organizing notes in directories
- ğŸ” **Hybrid Encryption**: RSA + AES-256-GCM encryption for secure storage
- ğŸ”’ **HMAC Integrity**: Cryptographic verification to detect tampering
- â±ï¸ **Auto-Lock**: Configurable session timeout for automatic locking
- ğŸ–±ï¸ **Drag & Drop**: Move files and folders with drag and drop
- ğŸ¨ **Theme Integration**: Follows your VS Code theme
- ğŸ§ **Secure Temp Storage**: Uses `/dev/shm` (RAM) for decrypted files on Linux

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SecureNotes Extension                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  extension.ts          â”‚  Main entry point, command registration â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  encryption.ts         â”‚  RSA+AES hybrid encryption, HMAC        â”‚
â”‚  tempFileManager.ts    â”‚  /dev/shm temp file management          â”‚
â”‚  notepadTreeProvider.tsâ”‚  Tree view data provider                â”‚
â”‚  commands.ts           â”‚  File/folder operations                 â”‚
â”‚  notepadDragAndDrop.ts â”‚  Drag and drop handling                 â”‚
â”‚  noteItem.ts           â”‚  Tree item representation               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  types.ts              â”‚  TypeScript interfaces                  â”‚
â”‚  errors.ts             â”‚  Structured error types                 â”‚
â”‚  logger.ts             â”‚  Structured logging                     â”‚
â”‚  fileUtils.ts          â”‚  File operations & utilities            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Requirements

- **Linux**: Required for encrypted file editing (uses `/dev/shm`)
- **RSA Key Pair**: Required for encryption (can be generated by the extension)

## Installation

1. Clone this repository
2. Run `npm install`
3. Run `npm run compile`
4. Press F5 to launch the extension in development mode

## Setup

### 1. Set Base Directory

1. Open Command Palette (`Ctrl+Shift+P`)
2. Run `SecureNotes: Set Base Directory`
3. Select the folder where you want to store your notes

### 2. Generate Key Pair (Optional)

If you don't have an RSA key pair:

1. Open Command Palette (`Ctrl+Shift+P`)
2. Run `SecureNotes: Generate Key Pair`
3. Select a secure location to save the keys
4. Optionally enter a passphrase to protect your private key

### 3. Enable Encryption

1. Open Settings (`Ctrl+,`)
2. Search for "SecureNotes"
3. Set `secureNotes.encryption.publicKeyPath` to your public key file
4. Set `secureNotes.encryption.privateKeyPath` to your private key file
5. Enable `secureNotes.encryption.enabled`

### 4. Encrypt Existing Notes (Optional)

1. Open Command Palette (`Ctrl+Shift+P`)
2. Run `SecureNotes: Encrypt All Notes`
3. Confirm the operation

## Configuration

| Setting | Description | Default |
|---------|-------------|---------|
| `secureNotes.baseDirectory` | Directory for notes | (empty) |
| `secureNotes.encryption.enabled` | Enable encryption | `false` |
| `secureNotes.encryption.publicKeyPath` | Path to public key | (empty) |
| `secureNotes.encryption.privateKeyPath` | Path to private key | (empty) |
| `secureNotes.encryption.sessionTimeoutMinutes` | Auto-lock timeout (0 = disabled) | `30` |

## Commands

| Command | Description |
|---------|-------------|
| `SecureNotes: Set Base Directory` | Configure notes directory |
| `SecureNotes: Unlock Notes` | Decrypt and access notes |
| `SecureNotes: Lock Notes` | Clear decrypted data from memory |
| `SecureNotes: Generate Key Pair` | Create new RSA keys |
| `SecureNotes: Encrypt All Notes` | Encrypt all files in base directory |
| `SecureNotes: Export Decrypted Notes` | Decrypt all notes to a directory |

## Security Features

### Hybrid Encryption

- **RSA-4096**: Used to encrypt a random AES key per file
- **AES-256-GCM**: Used to encrypt file content with authenticated encryption
- **HMAC-SHA256**: Additional integrity verification layer

### Secure Temp Files

On Linux, decrypted files are stored in `/dev/shm` which is:
- **RAM-based**: Never written to disk
- **Private**: Accessible only by your user (mode 0700)
- **Auto-cleaned**: Securely deleted when files are closed

### Session Management

- **Auto-lock**: Configurable timeout automatically locks notes
- **Secure deletion**: Temp files are overwritten with zeros before deletion
- **Memory clearing**: Keys are cleared from memory on lock

## File Format

Encrypted files (`.enc`) use JSON format:

```json
{
  "version": 2,
  "encryptedKey": "<base64 RSA-encrypted AES key>",
  "iv": "<base64 initialization vector>",
  "authTag": "<base64 GCM authentication tag>",
  "content": "<base64 AES-encrypted content>",
  "hmac": "<base64 HMAC for integrity>"
}
```

## Development

### Project Structure

```
src/
â”œâ”€â”€ extension.ts           # Entry point
â”œâ”€â”€ encryption.ts          # Encryption logic
â”œâ”€â”€ tempFileManager.ts     # Temp file management
â”œâ”€â”€ notepadTreeProvider.ts # Tree view provider
â”œâ”€â”€ commands.ts            # Command handlers
â”œâ”€â”€ notepadDragAndDrop.ts  # Drag & drop
â”œâ”€â”€ noteItem.ts            # Tree item class
â”œâ”€â”€ types.ts               # Type definitions
â”œâ”€â”€ errors.ts              # Error classes
â”œâ”€â”€ logger.ts              # Logging module
â””â”€â”€ fileUtils.ts           # File utilities
```

### Build Commands

```bash
npm run compile  # Build once
npm run watch    # Watch mode
npm run package  # Production build
npm run lint     # Run linter
```

### Debugging

1. Press F5 to launch extension in debug mode
2. View logs: Command Palette â†’ `SecureNotes: Show Log`

## Limitations

- **Linux Only**: Encrypted editing requires `/dev/shm`
- **No Windows Support**: Currently no secure temp storage for Windows

## License

MIT
